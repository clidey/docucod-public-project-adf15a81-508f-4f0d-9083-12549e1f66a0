---
title: "System Architecture Overview"
description: "Visualize how the extension operates: see how browser events are intercepted, how each tabâ€™s network activity is measured and stored, and how UI components communicate to present insights. Includes a mermaid diagram showing high-level data flow between the background script, popup, and browser APIs."
---

# System Architecture Overview

Understanding how uBO Scope operates at a system level empowers you to appreciate its unique capabilities and how it provides real-time insight into your browser's network activity. This page breaks down the core architecture, from event interception to data processing and user interface communication, revealing the flow of information that powers uBO Scope.

---

## How uBO Scope Works: At a Glance

uBO Scope functions as a browser extension that listens to network events happening in each active tab, intercepting, categorizing, and recording the status of every web request made by webpages. Its architecture is designed to efficiently track these network activities across tabs, store the data safely during the browsing session, and enable the popup UI to reflect this live information.

This system architecture balances real-time monitoring with efficient session persistence, ensuring minimal impact on browser performance while delivering accurate metrics.

---

## Core Components and Their Roles

- **Browser WebRequest API**: The backbone which emits network lifecycle events such as redirects, errors, and successful responses. uBO Scope hooks into these events to gather raw network request data.

- **Background Script (`background.js`)**: Acts as the central hub. It is responsible for:
  - Capturing and queuing network events.
  - Parsing request URLs to extract hostnames and domains.
  - Categorizing outcomes into allowed, stealth-blocked, or blocked.
  - Maintaining a detailed map of each tab's network activity.
  - Persisting session data between browser sessions.
  - Updating the browser action badge to reflect current stats.
  - Responding to messages from the UI popup requesting current tab data.

- **Public Suffix List (PSL) Library**: Provides accurate domain parsing logic to identify registrable domains and public suffixes, ensuring that domain aggregation is precise. This aids in grouping connections logically.

- **Popup UI (`popup.html` and `popup.js`)**: The interactive frontend presenting aggregated data to the user. It queries the background script for the tab-specific connection data and renders domains grouped by their outcome categories.

- **Extension APIs (`ext.js`)**: The abstraction layer for browser APIs powering storage, messaging, and runtime events uniformly across supported browsers.

---

## Workflow: From Network Requests to User Insights

1. **Network Request Interception**
   - The background script registers listeners on `onBeforeRedirect`, `onErrorOccurred`, and `onResponseStarted` events from the `webRequest` API.
   - Each event contains details about the request, including type, URL, tab, frame, and status.

2. **Event Queuing and Processing**
   - Rather than processing each event immediately, requests are queued briefly (around 1 second) to batch updates and enhance performance.
   - After the queue timer elapses, all batched events are processed together.

3. **Categorization of Connections**
   - For each request, uBO Scope updates the session's tab-specific data structure.
   - It extracts the hostname and domain using URL parsing and the Public Suffix List.
   - Requests are classified into:
     - **Allowed**: Visible connections successfully made.
     - **Stealth-blocked**: Requests redirected stealthily.
     - **Blocked**: Requests failing or explicitly blocked.

4. **Session Data Management**
   - The extension persistently stores this per-tab aggregation in the browser's session storage.
   - When tabs are closed, their data is purged to conserve memory.

5. **Badge Updates**
   - The browser action badge count reflects the number of distinct allowed third-party domains connected by the active tab, updated whenever the tab's data changes.

6. **Popup UI Communication**
   - When the popup opens, it sends a message to the background script requesting the current tab's network data.
   - The background script responds with serialized data, which the popup deserializes and renders.

---

## Data Structures and Storage

At the core of data management lies an organized, per-tab record system:

- Each tab has a `TABDETAILS_ENTITY` object recording:
  - `domain` and `hostname` of the main frame.
  - Three categories (`allowed`, `stealth`, `blocked`), each holding maps for domains and hostnames encountered.

- State is maintained in a `session` object containing a `tabIdToDetailsMap`, mapping tab IDs to their detailed network activity.

- Serialization and deserialization mechanisms ensure session data is efficiently stored and restored.

This structure ensures accurate and quick lookup, counts, and updates.

---

## User Interaction Flow

```mermaid
flowchart TD

  subgraph Browser
    NetworkEvents["WebRequest API Events"]
    BadgeUpdate["Browser Action Badge"]
    Tabs["Browser Tabs"]
  end

  subgraph BackgroundScriptModule["background.js"]
    RequestQueue["Network Request Queue"]
    ProcessEvents["Process & Categorize Requests"]
    SessionStorage["Session Data Storage"]
    MessageHandler["Runtime Message Listener"]
  end

  subgraph PopupUI["popup.html & popup.js"]
    PopupRequest["Request Tab Data"]
    RenderPanel["Render Domain Data"]
  end

  NetworkEvents --> RequestQueue
  RequestQueue --> ProcessEvents
  ProcessEvents --> SessionStorage
  ProcessEvents --> BadgeUpdate
  Tabs -->|Tab Closed| SessionStorage
  PopupRequest --> MessageHandler
  MessageHandler -->|Respond With Data| PopupRequest
  PopupRequest --> RenderPanel

  classDef module fill:#e3f2fd,stroke:#90caf9,stroke-width:2px
  class BackgroundScriptModule module
  class PopupUI module
