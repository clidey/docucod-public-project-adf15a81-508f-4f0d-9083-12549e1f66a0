---
title: "Extension Architecture"
description: "Presents a high-level architecture diagram and narrative: how the background script processes browser web requests, how stats are updated per tab, and how information is surfaced in the popup UI. Clarifies the role of supporting libraries and core data flows."
---

# Extension Architecture

Understanding the internal workings of uBO Scope is key to appreciating how it efficiently captures and reports the network activity you care about. This page breaks down the high-level architecture of the extension, revealing the journey of web requests from browser interception through data collection to user-facing presentation.

## How uBO Scope Monitors Third-Party Connections

At the heart of uBO Scope is the **background script** running privileged code that listens to all network requests made by the browser. This background process acts as the central hub to capture crucial details about every web request, categorize them, and update tab-specific statistics.

### Core Workflow

1. **Listening to network requests** 
   - Registered webRequest listeners track browser events such as request starts, redirects, completions, and errors.
   - These listeners are capable of handling HTTP, HTTPS, WebSocket, and Secure WebSocket protocols.

2. **Queuing and batching events**  
   - Instead of processing each event immediately and independently, uBO Scope uses a short timer-based queue to batch-process incoming network requests, improving efficiency.

3. **Classifying outcomes per tab**  
   - Requests are classified into three buckets based on their outcomes:
     - **Allowed** (requests completed successfully),
     - **Blocked** (requests that failed or were blocked),
     - **Stealth** (redirects and stealth blocking scenarios).
   - Each classification tracking maintains counts both at the domain level and the hostname level per browser tab.

4. **Updating the badge and persisting data**
   - After processing batches, the extension updates the browser toolbar badge to reflect the count of distinct allowed third-party domains for each tab.
   - Session data is saved locally, enabling continuity across extension reloads.

   <Check>
   This approach ensures you get an accurate, up-to-date view of third-party connections in real time without impacting browser performance.
   </Check>

### Domain and Hostname Resolution

To accurately group and count third-party requests, uBO Scope relies on the following:

- **Hostname extraction** from the request URL.
- **Domain determination utilizing the Public Suffix List (PSL)**
  - Ensures requests are counted by their effective registered domain to avoid fragmentation.
  - The PSL data is fetched once and cached per session to optimize lookup speed.
- **Unicode domain support via Punycode**
  - Domains are consistently converted to Unicode when displayed.

<Tip>
The use of the Public Suffix List enables uBO Scope to differentiate and count domains meaningfully, e.g., distinguishing example.co.uk from co.uk.
</Tip>

## Data Flow and Interaction Components

```mermaid
flowchart TD
  subgraph Browser
    Requests["Web Requests (HTTP/S, WS/WSS)"]
    Tabs["Browser Tabs"]
  end

  subgraph Background Script
    Listeners["webRequest Listeners"]
    Queue["Request Queue and Timer"]
    Classifier["Outcome Classifier per Tab"]
    SessionStorage["Session Storage (Local/Session)"]
    BadgeUpdater["Toolbar Badge Updater"]
    PSL["Public Suffix List Module"]
    Punycode["Punycode Handler"]
  end

  subgraph Popup UI
    Popup["Popup Interface"]
    PopupScript["Popup Script (popup.js)"]
  end

  Requests --> Listeners
  Listeners --> Queue
  Queue --> Classifier
  Classifier --> BadgeUpdater
  Classifier --> SessionStorage
  PopupScript -->|Requests Tab Data| Background Script
  Background Script -->|Returns Serialized Data| PopupScript
  BadgeUpdater --> Tabs
  PSL --> Classifier
  Punycode --> Classifier
```

- **Browser Tabs** generate web requests intercepted by the background listeners.
- **Background Script** components work together to classify and record outcomes:
  - Listeners capture network events.
  - The queue batches these events to be processed by the classifier.
  - The session storage persists this state to allow extension restarts without losing data.
  - The badge updater sets the toolbar icon text to show live counts.
- **Popup UI** displays collected data on demand by querying the background script.

## Role of Supporting Libraries

- **PublicSuffixList**: This library handles parsing and applying the Public Suffix List to determine domain boundaries, making counting more precise at the domain level.

- **Punycode**: Ensures correct display and encoding/decoding of internationalized domain names (IDNs).

- **s14e-serializer**: Efficiently serializes and deserializes session state data for storage and retrieval.

These libraries help uBO Scope deliver accurate, efficient, and readable results.

## User Experience: From Data Capture to Popup Display

When you browse the web:

- Every network request triggers background processing.
- The badge on the extension icon updates dynamically to show the number of distinct third-party domains successfully connected per tab.
- Clicking the icon opens the popup UI showing categorized lists of domains grouped as not blocked, stealth-blocked, or blocked, with counts for each.

This transparent reporting lets you understand exactly what remote servers your browser is communicating with on a per-tab basis.

## Practical Insights & Considerations

- **Efficient use of browser APIs:** By batching request events using a timer, the extension minimizes overhead, ensuring smooth browser performance even on sites with many network requests.

- **Tab-specific granularity:** Data is scoped and displayed per tab, supporting detailed audits and comparisons.

- **Persistence:** Session storage maintains state, so inadvertent browser or extension restarts don’t cause loss of historical connection data.

- **Separation of concerns:** The background script handles all logic and storage, while the popup serves purely as a UI to visualize that data, simplifying each component’s responsibilities.

<Tip>
If you notice discrepancies in the badge count or popup data, ensure your browser supports the webRequest API fully, as some newer browser versions or platforms may limit these capabilities.
</Tip>

---

For a deeper dive into related concepts, see the [Key Concepts and Terminology](./key-terms-concepts) page.

---

<AccordionGroup title="Common Questions About uBO Scope Architecture">
<Accordion title="Why does uBO Scope use a timer-based queue for network requests?">
Batching network request events allows the extension to process multiple updates together rather than handling each event individually. This reduces processing overhead, minimizes UI updates, and improves overall performance during browsing sessions with numerous network operations.
</Accordion>
<Accordion title="How does uBO Scope differentiate between allowed, blocked, and stealth connections?">
Requests that successfully complete are classified as allowed. Failed or errored requests are blocked. Redirects or silently blocked requests fall into the stealth category. This classification lets users distinguish between types of third-party connections.
</Accordion>
<Accordion title="What happens to data when a tab is closed?">
Tab-specific connection data is cleared from session storage immediately on tab removal, ensuring accurate and relevant statistics per active tab.
</Accordion>
</AccordionGroup>

<Source url="https://github.com/gorhill/uBO-Scope" paths={[{"path": "js/background.js", "range": "1-200"}]} />