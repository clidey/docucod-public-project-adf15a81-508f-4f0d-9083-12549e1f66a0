---
title: "System Architecture (with Diagram)"
description: "Visualize how the extension works internally using a mermaid diagram: from the browser’s network layer, through webRequest API listeners, to the background and popup scripts that collect and display connection data."
---

# System Architecture of uBO Scope

Understanding how uBO Scope works behind the scenes will empower you to fully leverage its capabilities and appreciate the transparency it brings to your browsing experience. This page breaks down the internal workflow and architecture of the extension, describing the journey of a network request from your browser to the detailed reporting you see in the popup interface.

---

## Overview

uBO Scope operates as a lightweight browser extension that monitors all network requests your browser initiates. Using the browser's `webRequest` API, it listens to key network events to classify connections as allowed, stealth-blocked, or blocked. These classifications are collected and stored in session data and seamlessly presented in the popup UI to give you a clear snapshot of third-party connections for the active tab.

This architecture ensures continuous real-time tracking and user-friendly visualization without intruding on browsing performance.

---

## Key Components

| Component            | Role                                                                                         |
|----------------------|----------------------------------------------------------------------------------------------|
| **Browser Network**  | Initiates HTTP(S) and WebSocket(S) requests from web pages and extensions.                   |
| **`webRequest` API** | Provides event hooks to observe network requests' lifecycle including redirects, successes, and errors.
| **Background Script**| Central hub responsible for processing network events, maintaining session data, and updating badge counts.
| **Popup Script**     | Retrieves session data for the current tab and renders it visually in the popup window.     |
| **Public Suffix List** | Used to accurately identify and group domains from hostnames for meaningful reporting.     |

---

## How the System Works

### 1. Network Event Capturing

Using the browser's `webRequest` hooks, the background script listens for these events:

- **onBeforeRedirect** — When a request is redirected.
- **onErrorOccurred** — When a request encounters an error and fails.
- **onResponseStarted** — When a request successfully starts receiving a response.

These events provide full coverage of network request outcomes, regardless of blocking by content filters or DNS.

### 2. Event Queueing and Processing

Events are queued in memory to efficiently batch process them approximately every second. This avoids excess computation for bursts of network activity.

Upon processing:

- The script resolves the domain and hostname for each request.
- Requests are categorized as **allowed**, **stealth-blocked**, or **blocked** based on the event type.
- These categories track connections using internal maps keyed by domains and hostnames.

### 3. Tab Session Data Management

Every browser tab has a dedicated detailed session record that tracks:

- The main domain and hostname actively viewed.
- Counts of connection attempts grouped into three grouped sets:
  - **Allowed:** Requests that succeeded and were not blocked.
  - **Stealth-blocked:** Requests silently prevented or redirected.
  - **Blocked:** Requests explicitly blocked with errors.

This session data persists via browser storage to survive tab reloads and closures.

### 4. Badge and Popup Rendering

The background script updates the toolbar icon badge per tab to display the number of distinct allowed third-party domains connected.

When you open the popup (`popup.html`), the popup script requests the current tab’s session data and formats it in three sections, clearly separating outcomes:

- Domains **not blocked** (allowed)
- Domains **stealth-blocked**
- Domains **blocked**

The domain counts and names are displayed for easy inspection.

---

## Mermaid Diagram of Architecture

```mermaid
flowchart TD

  BrowserNetwork["Browser Network Layer"]
  webRequestAPI["webRequest API Listeners"]
  BackgroundScript["Background Script
(event processing & data storage)"]
  SessionStorage["Browser Storage
(local and session)"]
  PopupScript["Popup Script
(data rendering)"]
  PopupUI["Popup UI
(popup.html)"]
  PublicSuffixList["Public Suffix List
(domain parsing)"]

  BrowserNetwork --> webRequestAPI
  webRequestAPI --> BackgroundScript

  BackgroundScript --> SessionStorage
  BackgroundScript -->|Badge Update| BrowserNetwork

  PopupScript --> SessionStorage
  PopupScript --> PublicSuffixList
  PopupScript --> PopupUI

  subgraph User
    PopupUI
  end

  classDef storage fill:#f9f,stroke:#333,stroke-width:1px;
  class SessionStorage storage;
  class BackgroundScript webRequestAPI BackgroundScript PopupScript;

```

---

## Practical Example: Tracking Connections per Tab

Consider you are visiting `example.com`:

1. The main frame request triggers a reset and initialization of tab session data.
2. As you browse, the background script captures all third-party connection attempts made by the page.
3. Connections to allowed servers increment counts in the "allowed" category.
4. Connections blocked by the content blocker are recorded under "blocked".
5. Redirected connections that are stealthily blocked fall into "stealth-blocked".
6. The popup, when opened, shows a categorized list of domains for you to analyze.
7. The toolbar badge on the extension icon updates to the total number of allowed third-party domains.

This workflow helps you easily identify which third parties your browser communicates with and their blocking outcomes.

---

## Tips & Best Practices

- **Interpreting Badge Counts:** A lower allowed count generally means fewer third-party connections and better privacy.
- **Using the Popup:** Check stealth and blocked lists to investigate suspicious or unintended connections.
- **Tab Isolation:** Each tab’s network environment is tracked separately for precise diagnostics.
- **Persistence:** Session data persists as long as the tab is open, ensuring continuity of insights.

---

## Troubleshooting Common Issues

- *No data in popup?* Ensure you have an active tab and the extension has necessary permissions.
- *Badge not updating?* Network requests may be outside `webRequest` API scope or the tab was just opened.
- *Unexpected domains appearing?* Some legitimate CDNs and services are expected; review domain lists carefully.

---

Explore related documentation to master uBO Scope:

- [What is uBO Scope?](../introduction-and-value/what-is-ubo-scope)
- [Quick Feature Overview](../architecture-concepts/feature-quick-overview)
- [Core Benefits and Use Cases](../introduction-and-value/core-benefits)

---

[View source and contribute on GitHub](https://github.com/gorhill/uBO-Scope)

