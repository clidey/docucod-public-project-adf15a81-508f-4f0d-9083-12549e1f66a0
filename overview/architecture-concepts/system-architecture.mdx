---
title: "How uBO Scope Works (with Diagram)"
description: "Understand uBO Scope's major building blocks and their data flow, illustrated with a simple architecture diagram. See how the background script tracks network requests, how data is persisted per tab, and how the popup user interface retrieves and displays this telemetry."
---

# How uBO Scope Works (with Diagram)

## Introduction
uBO Scope is designed to offer transparency into network connections made by websites as you browse. This page unveils the major building blocks of uBO Scope, illustrating how it tracks network requests, organizes connection data per browser tab, persists this information across sessions, and presents it via the popup user interface.

Understanding this flow empowers you to grasp how uBO Scope delivers precise connectivity telemetry — critical for privacy enthusiasts, filter list maintainers, and auditors aiming to monitor or validate third-party network interactions.

---

## Core Architecture Overview

At the heart of uBO Scope lies a simple but powerful interaction between several components:

- A **background script** that listens to all relevant network events across browser tabs.
- A **session data store** that records, categorizes, and persists connection outcomes by tab.
- A **public suffix list** that helps derive organizational domains from hostnames.
- A **popup interface** that queries and renders the collected data in a clear, categorized view.

Each piece works in concert to provide up-to-date, tab-specific reports on which remote servers have been connected to and whether the connections were allowed, blocked, or stealth blocked.

### How It Works

1. **Network Request Monitoring:**
   The background script uses the browser's `webRequest` API to register listeners for key network events including redirects, successful responses, and errors.

2. **Connection Categorization:**
   For every network event, uBO Scope determines whether the request was allowed (successful), blocked (error), or stealth-blocked (redirects indicating indirect blocks). It maps hostnames involved, using the public suffix list to cluster them by domain.

3. **Per-Tab Data Persistence:**
   Details are stored in session memory keyed by tab ID, capturing three categories:`allowed`, `blocked`, and `stealth`. This data includes counts and mappings between domains and hostnames.

4. **Badge Updates:**
   The browser toolbar icon badge dynamically reflects the count of distinct third-party domains allowed per active tab, giving you an at-a-glance view of connection breadth.

5. **Popup UI Rendering:**
   When you open the popup panel, it requests serialized tab-specific data from the background script, deserializes it, and presents a clear breakdown:
   - **Not blocked:** Domains with allowed connections.
   - **Stealth-blocked:** Domains affected by stealth blocking.
   - **Blocked:** Domains where connections were outright blocked.

This enables quick, practical inspection without deep technical knowledge.

---

## Detailed Component Roles

### Background Script

- Registers listeners for `onBeforeRedirect`, `onErrorOccurred`, and `onResponseStarted` events on network requests matching host permissions.
- Queues captured events in a journal.
- Processes the journal to update per-tab connection info without loss or duplication.
- Resets and updates per-tab data on main frame navigation.
- Uses the public suffix list to group hostnames by domain, improving clarity.
- Persists session data asynchronously to browser session storage for reliability and fast recovery.
- Updates the badge count to reflect the active tab's allowed third-party domains.

### Session Data Structure

```javascript
{
  tabId: Number,
  domain: String,      // base domain for the tab's hostname
  hostname: String,    // full hostname for the main frame
  allowed: {
    domains: Map<domain, count>,
    hostnames: Map<hostname, count>
  },
  stealth: {
    domains: Map<domain, count>,
    hostnames: Map<hostname, count>
  },
  blocked: {
    domains: Map<domain, count>,
    hostnames: Map<hostname, count>
  }
}
```

This structure enables effective grouping and counting for each outcome type, keyed by hostname and domain.

### Public Suffix List Integration

uBO Scope loads and caches the [public suffix list](https://publicsuffix.org/list/public_suffix_list.dat), a critical resource to correctly derive registered domains from full hostnames (e.g., turning "sub.example.co.uk" into "example.co.uk"). This clarifies which third-party entities the domains represent.

### Popup User Interface

- Upon invocation, it queries the background script for the current tab's serialized telemetry data.
- Deserializes and renders the tab's hostname at the top, using Unicode conversion for internationalized domain names.
- Displays counts and domain lists under **not blocked**, **stealth-blocked**, and **blocked** categories.
- Employs visual cues and badges to indicate the number of connections per domain for easy analysis.

### User Flow in Popup

1. Open popup for the active tab.
2. Popup requests recorded data for that tab from the background script.
3. Data is rendered, showing:
   - The main hostname.
   - Total number of connected domains.
   - Categorized lists of domains by connection outcome, each with connection counts.

This intuitive flow lets users quickly gauge the privacy or connectivity state of the page.

---

## Example: Simplified Sequence of Events

1. You navigate to a website.
2. Background script detects a main frame request and resets tab data.
3. As the page loads resources, network events fire:
   - Successful connections update `allowed` domains.
   - Requests blocked by content blockers mark `blocked` domains.
   - Redirected requests suspected as stealth blocking update `stealth` domains.
4. Badge count updates to the total number of allowed third-party domains.
5. Opening the popup presents a real-time summary of these conditions.

---

## Architecture Diagram

```mermaid
flowchart TD
  bg["Background Script"]
  net["Network Request Events
(onBeforeRedirect, onErrorOccurred, onResponseStarted)"]
  journal["Network Request Journal
(Queued Events)"]
  session["Session Data Store
(Per-Tab Connection Details)"]
  psl["Public Suffix List
(Domain Extraction)"]
  popup["Popup UI
(Deserialization & Rendering)"]
  badge["Toolbar Badge
(Allowed Domains Count)"]

  net --> |Tracks events| journal
  journal --> |Processes events| bg
  bg --> |Queries domain info| psl
  bg --> |Updates| session
  session --> |Provides data| popup
  bg --> |Updates count| badge

  click bg href="js/background.js"
  click popup href="js/popup.js"
  click psl href="assets/thirdparties/publicsuffix.org/list/public_suffix_list.dat"

  subgraph "User Actions"
    userOpenPopup["User Opens Popup"] --> popup
    userNavigate["User Navigates to Website"] --> net
  end

  style bg fill:#f9f,stroke:#333,stroke-width:2px
  style popup fill:#bbf,stroke:#333,stroke-width:2px
  style session fill:#afa,stroke:#333,stroke-width:2px
  style psl fill:#ffb,stroke:#333,stroke-width:2px
  style journal fill:#ddd,stroke:#333,stroke-width:1px
  style badge fill:#fbb,stroke:#333,stroke-width:1px
```

---

## Practical Tips

- The badge count on the toolbar icon always reflects the number of distinct allowed third-party domains for the active tab. A lower number usually indicates fewer external connections.
- Opening the popup after loading a page gives you detailed, actionable insights into which domains are blocked, stealth-blocked, or allowed.
- The categorization helps spot suspicious or unexpected connections that you may want to investigate further or block via uBlock Origin or other filters.

## Common Pitfalls

- Do not rely on block counts alone to judge content blocker effectiveness—focus on how many third-party domains are allowed.
- Keep in mind some connections may be stealth-blocked and not immediately obvious without reviewing the **stealth-blocked** section.
- Make sure the browser supports and exposes full `webRequest` API data; connections outside this scope (e.g., certain DNS-based blocks) may not be reported.

---

## Summary
This page detailed how uBO Scope operates behind the scenes to monitor, organize, and present network connection data per tab. You learned about the background script's role in capturing events, the usage of the public suffix list for domain classification, session data persistence, and the popup's user-friendly visualization.

Together, these components form a transparent system that empowers you with visibility into third-party network connections — an essential foundation for effective privacy assessment and filter list maintenance.

---

## Next Steps
- Explore [Who Is uBO Scope For?](/overview/introduction-core-value/audience-usecases) to understand how different users gain value from this tool.
- Review [Key Features at a Glance](/overview/introduction-core-value/feature-glance) for practical UI elements and workflows.
- For hands-on interaction, read [Your First Open: Using the Popup](/getting-started/first-run-usage/first-open) to get started viewing your own telemetry data.

---

<Source url="https://github.com/gorhill/uBO-Scope" branch="main" paths={[{"path": "js/background.js", "range": "1-217"},{"path": "js/popup.js", "range": "1-70"}]} />

