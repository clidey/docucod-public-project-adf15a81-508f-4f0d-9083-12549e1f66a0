---
title: "System Architecture Overview"
description: "Visualizes how the different components—background script, popup UI, client messaging, and data persistence—work together. Uses a simple Mermaid diagram to show information flow and responsibilities, making it easy to grasp how uBO Scope observes and reports domain connections."
---

# System Architecture Overview

Understanding how uBO Scope operates internally clarifies how it delivers detailed visibility into third-party remote server connections. This page presents a clear visualization of the primary components—the background script handling network monitoring and data persistence, the popup user interface facilitating user interaction, the messaging system linking them, and the mechanisms that manage data flow and responsibilities.

---

## Exploring the Core Components

uBO Scope is composed of several JavaScript-driven components that collaborate seamlessly within the browser extension framework to track, process, and display connection information in real time.

### Background Script

At the heart of uBO Scope is the background script (`background.js`). This component:

- Listens to network events via the browser's `webRequest` API, capturing detailed information about every attempted, successful, stealth-blocked, or blocked connection to third-party domains.
- Maintains a session data store that tracks connection outcomes per tab, organizing hostnames and their related domains.
- Updates the toolbar icon badge with the count of distinct allowed third-party domains per active tab.
- Manages persistent session storage, ensuring data continuity as the user browses or closes tabs.

### Popup User Interface (UI)

The popup UI, presented in `popup.html` with styling from `popup.css` and scripting in `popup.js`, is the visible layer users interact with. It:

- Shows the tab's hostname and domain, letting users immediately identify the page they are analyzing.
- Categorizes observed third-party domains into three outcomes: *not blocked*, *stealth-blocked*, and *blocked*, detailing each with domain names and request counts.
- Dynamically retrieves data from the background script using a messaging system and efficiently renders it into the UI for immediate feedback.
- Ensures accessibility and readability through a clean, responsive layout showing counts alongside domains.

### Client Messaging

Inter-component communication uses the browser's runtime messaging APIs:

- The popup UI requests current tab data from the background script with a specific message.
- The background script serializes the stored tab details and replies promptly.
- This asynchronous, event-driven communication model ensures the popup always presents the most recent and accurate connection data without impacting browser performance.

### Data Persistence & Domain Parsing

uBO Scope employs nuanced mechanisms for maintaining session data and accurately classifying domains:

- It uses serialized maps to store information and saves session data in browser session storage, ensuring statefulness during browsing sessions.
- Incorporates the Public Suffix List (PSL) to determine base domains from hostnames so that tracking aggregates connection counts by domain rather than raw hostname.
- Utilizes Punycode decoding to support internationalized domain names for proper display.

---

## How Information Flows

This diagram visualizes the interplay of components and data flow within uBO Scope, offering a straightforward representation of responsibilities and communication channels.

```mermaid
flowchart TD

  BS["Background Script (background.js)"]
  UI["Popup UI (popup.html, popup.js)"]
  MSG["Client Messaging via runtime API"]
  STORAGE["Session Data Persistence"]
  PSL["Public Suffix List Parsing"]
  URLPARSER["URL & Domain Parsing"]

  %% Network events flow into background script
  BrowserRequest-->|"webRequest API events"|BS

  %% Background script records and processes network requests
  BS-->|"Uses PSL & URL Parsing"|PSL
  BS-->|"Uses URL Parsing"|URLPARSER

  %% Background script stores session data
  BS-->|"Saves & Loads session data"|STORAGE

  %% Popup interacts with background script via messaging
  UI-->|"Requests tab data"|MSG
  MSG-->|"Fetches serialized tab data"|BS
  BS-->|"Replies with tab data"|MSG
  MSG-->|"Delivers tab data"|UI

  %% Popup renders UI from received data
  UI-->|"Renders connection outcomes"|

  %% Annotation
  classDef component fill:#f0f9ff,stroke:#333,stroke-width:1px;
  class BS,UI,MSG,STORAGE,PSL,URLPARSER component;

```

---

## Practical Example: User Journey

1. **User visits a webpage in a new tab.**
2. The background script listens to all network requests, categorizing each connection as allowed, blocked, or stealth-blocked based on network outcome.
3. Tab-specific connection details are stored and updated asynchronously, with public suffix domain determination refining the grouping.
4. The toolbar badge updates to reflect the number of allowed third-party domains.
5. When the user opens the popup, it sends a message to the background script requesting the current tab's connection data.
6. The background script responds with serialized domain outcome data.
7. The popup UI deserializes the data and displays domains under their respective categories, enhancing user understanding of active third-party connections.

---

## Best Practices & Tips

- **Understanding Session Persistence:** Be aware that uBO Scope maintains session data only for the current browsing session. Closing tabs removes their details from storage.
- **Focus on Domains, Not Just URLs:** Using the Public Suffix List ensures domains are counted and reported consistently, avoiding fragmentation caused by subdomains.
- **Popup Loading:** If the popup displays 'NO DATA', wait a second and refresh by closing and reopening the popup—this allows time for the background script to update data.
- **Badge Counts:** The badge count reflects allowed connections only and provides a quick snapshot without opening the popup.

---

## Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting System Architecture">
<Accordion title="Popup shows no data or outdated information">
- Ensure that a tab is active and making network connections.
- Refresh the popup window to request fresh data from the background.
- Verify that the browser has granted necessary permissions (e.g., webRequest).
</Accordion>
<Accordion title="Toolbar badge is missing or incorrect">
- Badge is updated only for tabs tracked by the extension; tabs opened before starting uBO Scope might lack data.
- Network requests made outside the `webRequest` API scope (e.g., some WebSocket connections) might not be counted.
- Verify no conflicting extensions disable or interfere with `webRequest` listeners.
</Accordion>
<Accordion title="Extension data clearing unexpectedly">
- Closing tabs removes stored connection outcomes for that tab.
- Data is persisted in session storage, which clears on browser restart.
</Accordion>
</AccordionGroup>

---

## Additional Resources

For a more comprehensive perspective and context:

- [What is uBO Scope?](/overview/product-introduction-and-value/what-is-ubo-scope): Learn the core purpose and value of the product.
- [Key Benefits & Use Cases](/overview/product-introduction-and-value/key-benefits-and-use-cases): See why uBO Scope matters for privacy and filter list maintenance.
- [Core Concepts & Terminology](/overview/core-concepts-and-architecture/core-concepts-and-terminology): Understand essential terms used in this and other pages.
- [Interpreting the Toolbar Badge and Popup](/guides/getting-started-essentials/interpreting-badge-and-popup): How to read the UI elements described.

Additionally, the source code repository at [uBO Scope GitHub](https://github.com/gorhill/uBO-Scope) includes implementation details for those who want to dive deeper.

---

This System Architecture Overview bridges the gap between uBO Scope’s underlying mechanics and its user-facing insights. By grasping the flow of data and responsibilities across components, users gain confidence in interpreting the extension’s reporting and trust its value in analyzing web traffic connections.